// إعدادات قابلة للتعديل
const CONFIG = {
  prices: { shawarma: 12.0, pepsi: 4.0 }, // ر.س
  prepMinutes: 10
};

// ربط الأسعار في الواجهة
document.getElementById("price-shawarma").textContent = CONFIG.prices.shawarma.toFixed(2);
document.getElementById("price-pepsi").textContent = CONFIG.prices.pepsi.toFixed(2);
document.getElementById("prepTime").textContent = CONFIG.prepMinutes;

const state = { shawarma: 0, pepsi: 0 };

function updateTotals(){
  const total = state.shawarma * CONFIG.prices.shawarma + state.pepsi * CONFIG.prices.pepsi;
  document.getElementById("total").textContent = total.toFixed(2);
  const submit = document.getElementById("submitBtn");
  submit.disabled = total <= 0;
  // تحديث الحقل الخفي
  document.getElementById("itemsField").value = JSON.stringify(state);
}

function adjust(card, delta){
  const input = card.querySelector(".count");
  let val = parseInt(input.value || "0", 10);
  val = Math.max(0, val + delta);
  input.value = val;
  const id = card.dataset.id;
  state[id] = val;
  updateTotals();
}

document.querySelectorAll(".card").forEach(card=>{
  card.querySelector(".plus").addEventListener("click", ()=>adjust(card, +1));
  card.querySelector(".minus").addEventListener("click", ()=>adjust(card, -1));
  card.querySelector(".count").addEventListener("input", (e)=>{
    const n = Math.max(0, parseInt(e.target.value || "0", 10));
    e.target.value = n;
    state[card.dataset.id] = n;
    updateTotals();
  });
});

const form = document.getElementById("orderForm");
form.addEventListener("submit", async (e)=>{
  e.preventDefault();
  if (!form.reportValidity()) return;

  const data = Object.fromEntries(new FormData(form).entries());
  const order = {
    id: "ORD-" + Math.random().toString(36).slice(2,8).toUpperCase(),
    items: { ...state },
    total: Number(document.getElementById("total").textContent),
    name: data.name,
    phone: data.phone,
    pickup: data.pickup,
    notes: data.notes || "",
    createdAt: new Date().toISOString()
  };

  // إرسال بدون باك إند (اختياري: استبدل بـ Formspree/Webhook)
  try{
    // مثال تكامل سريع مع Formspree:
    // await fetch("https://formspree.io/f/xxxxxxx", { method:"POST", headers:{ "Content-Type":"application/json" }, body: JSON.stringify(order) });

    // عرض نجاح محلي
    document.getElementById("orderId").textContent = order.id;
    document.getElementById("success").classList.remove("hidden");
    form.reset();
    state.shawarma = 0; state.pepsi = 0;
    updateTotals();
    window.scrollTo({ top: document.getElementById("order").offsetTop - 20, behavior: "smooth" });
  }catch(err){
    alert("تعذّر إرسال الطلب، حاول لاحقاً");
  }
});

updateTotals();
